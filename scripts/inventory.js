function renderInventory(){ Promise.all([ loadCSV('data/equipment.csv'), loadPlayer() ]).then(([catalog, player])=>{ const merged = catalog.map(it=> Object.assign({}, it, { acquired: (player.acquired||[]).includes(it.id), equipped: (player.equipped||[]).includes(it.id)})); const list = el('inventory-list'); if(!list) return; list.innerHTML=''; merged.forEach(item=>{ const row = create('div','inventory-item'); row.innerHTML = '<div><strong>'+item.name+'</strong><div class="small">'+item.category+' · '+item.rarity+' · Tier '+item.tier+'</div></div>'; const btn = create('button','btn'); btn.textContent = item.acquired ? (item.equipped ? 'Desequipar' : 'Equipar') : 'Adquirir'; btn.addEventListener('click', ()=> toggleItem(item.id)); row.appendChild(btn); list.appendChild(row); }); const equipSlots = document.getElementById('equip-slots'); if(equipSlots){ equipSlots.querySelectorAll('.slot').forEach(s=>{ const slotName = s.dataset.slot; const eq = (player.equipped||[])[0]; s.querySelector('.slot-val').textContent = eq ? (merged.find(x=>x.id===eq)||{}).name || 'Sin equipo' : 'Sin equipo'; }); } }); } function toggleItem(id){ loadPlayer().then(player=>{ player.acquired = player.acquired || []; player.equipped = player.equipped || []; if(!player.acquired.includes(id)){ player.acquired.push(id); notify('Ítem adquirido'); } else { if(player.equipped.includes(id)){ player.equipped = player.equipped.filter(x=>x!==id); notify('Desequipado'); } else { player.equipped = [id]; notify('Equipado'); } } savePlayer(player); window.AGIL_PLAYER = player; renderInventory(); }); } document.addEventListener('DOMContentLoaded', ()=> renderInventory());