const MISSIONS_KEY = 'agilrpg_v4_missions'; function loadMissions(){ const raw = localStorage.getItem(MISSIONS_KEY); if(raw) return JSON.parse(raw); const seed=[{id:'m1',title:'Lavar platos',state:'pending',rewards:{A:1}},{id:'m2',title:'Leer 30 min',state:'pending',rewards:{A:2}}]; localStorage.setItem(MISSIONS_KEY, JSON.stringify(seed)); return seed; } function saveMissions(ms){ localStorage.setItem(MISSIONS_KEY, JSON.stringify(ms)); } function renderKanbanForState(state){ const body = document.getElementById('kanban-body'); if(!body) return; body.innerHTML=''; const ms = loadMissions().filter(m=>m.state===state); ms.forEach(m=>{ const c = create('div','task-card'); c.innerHTML = '<div><strong>'+m.title+'</strong><div class="small">Recompensa: '+(m.rewards?.A||0)+' ✦</div></div>'; c.addEventListener('click', ()=> openMission(m.id)); body.appendChild(c); }); } function renderKanban(){ renderKanbanForState('pending'); window.renderKanbanForState = renderKanbanForState; document.getElementById('fab-add-mission')?.addEventListener('click', ()=>{ const t = prompt('Título de la misión:'); if(!t) return; const ms = loadMissions(); const id='m'+Math.random().toString(36).slice(2,6); ms.push({id,title:t,state:'pending',rewards:{A:1}}); saveMissions(ms); renderKanbanForState('pending'); notify('Misión creada'); }); } function openMission(id){ const ms = loadMissions(); const m = ms.find(x=>x.id===id); if(!m) return; const action = prompt('Acciones: (c)Completar, (e)Editar, (d)Eliminar'); if(!action) return; if(action.toLowerCase()==='c'){ m.state='done'; saveMissions(ms); loadPlayer().then(p=>{ p.acquired = p.acquired || []; p.equipped = p.equipped || []; if(!p.acquired.includes('2344')) p.acquired.push('2344'); savePlayer(p); notify('Recompensa otorgada'); renderInventory(); }); renderKanbanForState('pending'); } else if(action.toLowerCase()==='d'){ if(confirm('Eliminar?')){ const idx=ms.findIndex(x=>x.id===id); if(idx>-1) ms.splice(idx,1); saveMissions(ms); renderKanbanForState('pending'); notify('Eliminada'); } } } document.addEventListener('DOMContentLoaded', ()=>{ renderKanban(); });